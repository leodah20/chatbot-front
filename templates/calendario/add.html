<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Adicionar Matéria</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/calendario_styles.css') }}">
  
  <!-- Sistema de Toasts -->
  {% include '_toasts.html' %}
</head>
<body class="page-body">
  
  <header class="page-header">
    <div class="header-top">
      <div class="header-brand">
        <a href="{{ url_for('dashboard') }}" style="text-decoration: none;">
          <img class="header-logo" src="https://api.builder.io/api/v1/image/assets/TEMP/fb4d5eed694b229a53829dcdc98665ec0db0d36c?width=558" alt="UNIP">
        </a>
        <h1 class="header-title">Painel Administrativo</h1>
      </div>
      <div class="header-user">
        <div class="user-info-panel">
          <div class="user-name-text">{{ user.nome|title if user and user.nome else '' }}</div>
          <div class="user-email-text">{{ user.email if user and user.email else '' }}</div>
        </div>
        <a href="{{ url_for('logout') }}" class="btn-logout">sair</a>
      </div>
    </div>
    <div class="header-submenu">
      <div class="submenu-wrapper">
        <svg class="icon-menu" width="25" height="19" viewBox="0 0 25 19" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M23.9919 6.66468H1M23.9919 1H1M23.9919 12.3294H1M23.9919 17.994H1" stroke="white" stroke-width="1.9993" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span class="submenu-text">Menu</span>
        <div class="dropdown-menu">
          <a href="{{ url_for('dashboard') }}" class="dropdown-item">Home</a>
          <a href="{{ url_for('calendario_list') }}" class="dropdown-item">Calendário</a>
          <a href="{{ url_for('conteudo_list') }}" class="dropdown-item">Conteúdo</a>
          <a href="{{ url_for('docentes_list') }}" class="dropdown-item">Informações Docentes</a>
          <a href="{{ url_for('infos_curso_list') }}" class="dropdown-item">Informações Curso</a>
          <a href="{{ url_for('avisos_list') }}" class="dropdown-item">Avisos</a>
          <a href="{{ url_for('duvidas_frequentes_list') }}" class="dropdown-item">Dúvidas Frequentes</a>
        </div>
      </div>
    </div>
  </header>

  <main class="page-main">
    <div class="container-card">
      <div class="calendar-header">
        <div class="calendar-title-wrapper">
          <svg class="calendar-icon" viewBox="0 0 120 133" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M0.228394 25.4744C0.228394 23.807 1.5801 22.4553 3.24752 22.4553H9.84888C11.5163 22.4553 12.868 23.807 12.868 25.4744V125.599C12.868 127.266 11.5163 128.618 9.84888 128.618H3.24752C1.5801 128.618 0.228394 127.266 0.228394 125.599V25.4744Z" fill="#3292F9"/>
            <path d="M24.2438 3.51009C24.2438 1.84268 25.5955 0.490967 27.2629 0.490967H40.1841C41.8515 0.490967 43.2032 1.84267 43.2032 3.51009V23.0973C43.2032 24.7647 41.8515 26.1164 40.1841 26.1164H27.2629C25.5955 26.1164 24.2438 24.7647 24.2438 23.0973V3.51009Z" fill="#3292F9"/>
            <path d="M76.0662 3.51009C76.0662 1.84268 77.4179 0.490967 79.0853 0.490967H92.0065C93.6739 0.490967 95.0256 1.84267 95.0256 3.51009V23.0973C95.0256 24.7647 93.6739 26.1164 92.0065 26.1164H79.0853C77.4179 26.1164 76.0662 24.7647 76.0662 23.0973V3.51009Z" fill="#3292F9"/>
            <path d="M24.2438 59.0637H44.4672V76.1473H24.2438V59.0637Z" fill="#3292F9"/>
            <path d="M24.2438 83.4687H44.4672V100.552H24.2438V83.4687Z" fill="#3292F9"/>
            <path d="M49.5231 83.4687H69.7464V100.552H49.5231V83.4687Z" fill="#3292F9"/>
            <path d="M49.5231 59.0637H69.7464V76.1473H49.5231V59.0637Z" fill="#3292F9"/>
            <path d="M76.0662 59.0637H96.2896V76.1473H76.0662V59.0637Z" fill="#3292F9"/>
            <path d="M74.8018 83.4687H95.0252V100.552H74.8018V83.4687Z" fill="#3292F9"/>
            <path d="M3.24751 132.279C1.5801 132.279 0.228394 130.927 0.228394 129.26V119.435C0.228394 117.767 1.5801 116.416 3.24752 116.416H116.022C117.689 116.416 119.041 117.767 119.041 119.435V129.26C119.041 130.927 117.689 132.279 116.022 132.279H3.24751Z" fill="#3292F9"/>
            <path d="M3.24751 44.4206C1.5801 44.4206 0.228394 43.0689 0.228394 41.4015V23.0345C0.228394 21.3671 1.5801 20.0154 3.24752 20.0154H116.022C117.689 20.0154 119.041 21.3671 119.041 23.0345V41.4015C119.041 43.0689 117.689 44.4206 116.022 44.4206H3.24751Z" fill="#3292F9"/>
            <path d="M106.401 25.4744C106.401 23.807 107.753 22.4553 109.421 22.4553H116.022C117.689 22.4553 119.041 23.807 119.041 25.4744V125.599C119.041 127.266 117.689 128.618 116.022 128.618H109.421C107.753 128.618 106.401 127.266 106.401 125.599V25.4744Z" fill="#3292F9"/>
          </svg>
          <h2 class="calendar-title">Calendário</h2>
        </div>
      </div>
      
      <div class="add-section">
        <svg class="icon-add" viewBox="0 0 62 62" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M30.5527 5.55273V55.5527M5.55273 30.5527H55.5527" stroke="#2C8DFA" stroke-width="11.1047" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span class="add-text">Adicionar Matéria</span>
      </div>
      
      <div class="separator-line"></div>

      <div class="wizard-container">
        <h3 class="wizard-step-label">Etapa {{ step }} de 4</h3>

        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            <div class="messages-area" style="display: none;">
              {% for category, message in messages %}
                <div class="message-box message-{{ category }}">{{ message }}</div>
              {% endfor %}
            </div>
          {% endif %}
        {% endwith %}

        {% if step == 1 %}
        <form class="wizard-form" method="post">
          <input type="hidden" name="step" value="1" />
          
          <div class="form-field-group">
            <label class="field-label">Nome da Matéria:</label>
            <input class="field-input" name="nome" type="text" placeholder="Ex: Engenharia de Software" value="{{ wizard.nome or '' }}" required />
          </div>

          <div class="form-field-group">
            <label class="field-label">Professor Responsável</label>
            <select class="field-select" name="professor">
              <option value="">Selecione</option>
              {% if professores %}
                {% for prof in professores %}
                  {% set nome_completo = prof.get('nome_completo') or (prof.get('nome_professor', '') + ' ' + prof.get('sobrenome_professor', '')).strip() %}
                  {% if nome_completo %}
                    <option value="{{ nome_completo }}" {% if wizard.professor == nome_completo %}selected{% endif %}>{{ nome_completo }}</option>
                  {% endif %}
                {% endfor %}
              {% endif %}
            </select>
          </div>

          <div class="form-field-group">
            <label class="field-label">Código Disciplina:</label>
            <input class="field-input field-half" name="codigo" type="text" placeholder="Ex: N78452" value="{{ wizard.codigo or '' }}" />
          </div>

          <div class="form-field-group">
            <label class="field-label">Carga Horária:</label>
            <input class="field-input field-half" name="carga_horaria" type="text" placeholder="Ex: 60h" value="{{ wizard.carga_horaria or '' }}" />
          </div>

          <div class="form-field-group">
            <label class="field-label">Modalidade</label>
            <select class="field-select field-medium" name="modalidade">
              <option value="">Selecione</option>
              <option value="Presencial" {% if wizard.modalidade == 'Presencial' %}selected{% endif %}>Presencial</option>
              <option value="EAD" {% if wizard.modalidade == 'EAD' %}selected{% endif %}>EAD</option>
              <option value="Híbrido" {% if wizard.modalidade == 'Híbrido' %}selected{% endif %}>Híbrido</option>
            </select>
          </div>

          <div class="form-actions">
            <a class="btn-action btn-cancel" href="{{ url_for('calendario_list') }}">
              <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M13 1L1 13M1 1L13 13" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              Cancelar
            </a>
            <button class="btn-action btn-next" type="submit">
              <svg width="19" height="17" viewBox="0 0 19 17" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M1 8.5H18M18 8.5L9.5 1M18 8.5L9.5 16" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              Próximo
            </button>
          </div>
        </form>

        {% elif step == 2 %}
        <form class="wizard-form" method="post" enctype="multipart/form-data">
          <input type="hidden" name="step" value="2" />

          <div class="form-field-group">
            <label class="field-label">Ementa da Matéria</label>
            <div class="textarea-wrapper">
              <textarea class="field-textarea" name="ementa_resumo" rows="7" maxlength="1000" placeholder="Faça um breve resumo da ementa da disciplina, abordando o objetivo geral e os principais tópicos.">{{ wizard.ementa_resumo or '' }}</textarea>
              <span class="char-counter">0 / 1000 caracteres</span>
            </div>
          </div>

          <div class="form-field-group">
            <label class="field-label">Documento da Ementa Completa</label>
            <div class="file-upload-area">
              <input type="file" name="ementa_arquivo" id="ementa-file" accept=".pdf,.docx" class="file-input-hidden" />
              <label for="ementa-file" class="btn-file-select">Selecionar Arquivo</label>
              <span class="file-hint">*Apenas arquivos .pdf ou .docx</span>
              <div id="ementa-file-name" class="file-name-display" style="display: none; margin-top: 10px; padding: 8px; background-color: #f0f0f0; border-radius: 4px; color: #023D71; font-size: 14px;"></div>
            </div>
          </div>

          <div class="form-actions">
            <a class="btn-action btn-cancel" href="{{ url_for('calendario_list') }}">
              <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M13 1L1 13M1 1L13 13" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              Cancelar
            </a>
            <a class="btn-action btn-back" href="{{ url_for('calendario_add', step=1) }}">
              <svg width="19" height="17" viewBox="0 0 19 17" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M18 8.5L1 8.5M1 8.5L9.5 16M1 8.5L9.5 1" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              Voltar
            </a>
            <button class="btn-action btn-next" type="submit">
              <svg width="19" height="17" viewBox="0 0 19 17" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M1 8.5H18M18 8.5L9.5 1M18 8.5L9.5 16" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              Próximo
            </button>
          </div>
        </form>

        {% elif step == 3 %}
        <form class="wizard-form" method="post">
          <input type="hidden" name="step" value="3" />

          <div class="form-field-group">
            <label class="field-label">Dia da Semana:</label>
            <select class="field-select" name="dia_semana">
              <option value="">Selecione</option>
              <option value="segunda-feira" {% if wizard.dia_semana == 'segunda-feira' %}selected{% endif %}>Segunda-feira</option>
              <option value="terça-feira" {% if wizard.dia_semana == 'terça-feira' %}selected{% endif %}>Terça-feira</option>
              <option value="quarta-feira" {% if wizard.dia_semana == 'quarta-feira' %}selected{% endif %}>Quarta-feira</option>
              <option value="quinta-feira" {% if wizard.dia_semana == 'quinta-feira' %}selected{% endif %}>Quinta-feira</option>
              <option value="sexta-feira" {% if wizard.dia_semana == 'sexta-feira' %}selected{% endif %}>Sexta-feira</option>
            </select>
          </div>

          <div class="form-row-group">
            <div class="form-field-group">
              <label class="field-label">Horário Inicío:</label>
              <input class="field-input" name="hora_inicio" type="time" value="{{ wizard.hora_inicio or '' }}" />
            </div>
            <div class="form-field-group">
              <label class="field-label">Horário Fim:</label>
              <input class="field-input" name="hora_fim" type="time" value="{{ wizard.hora_fim or '' }}" />
            </div>
          </div>

          <div class="form-field-group">
            <label class="field-label">Sala:</label>
            <select class="field-select" name="sala">
              <option value="">Selecione</option>
              <option value="427" {% if wizard.sala == '427' %}selected{% endif %}>427</option>
              <option value="428" {% if wizard.sala == '428' %}selected{% endif %}>428</option>
            </select>
          </div>

          <div class="form-actions">
            <a class="btn-action btn-cancel" href="{{ url_for('calendario_list') }}">
              <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M13 1L1 13M1 1L13 13" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              Cancelar
            </a>
            <a class="btn-action btn-back" href="{{ url_for('calendario_add', step=2) }}">
              <svg width="19" height="17" viewBox="0 0 19 17" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M18 8.5L1 8.5M1 8.5L9.5 16M1 8.5L9.5 1" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              Voltar
            </a>
            <button class="btn-action btn-next" type="submit">
              <svg width="19" height="17" viewBox="0 0 19 17" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M1 8.5H18M18 8.5L9.5 1M18 8.5L9.5 16" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              Próximo
            </button>
          </div>
        </form>

        {% elif step == 4 %}
        <form class="wizard-form" method="post">
          <input type="hidden" name="step" value="4" />

          <div class="exam-section">
            <h3 class="exam-title">NP1</h3>
            <div class="form-field-group">
              <label class="field-label">Data:</label>
              <input class="field-input field-small" name="np1_data" type="date" />
            </div>
            <div class="form-row-group">
              <div class="form-field-group">
                <label class="field-label">Horário Inicío:</label>
                <input class="field-input" name="np1_inicio" type="time" />
              </div>
              <div class="form-field-group">
                <label class="field-label">Horário Fim:</label>
                <input class="field-input" name="np1_fim" type="time" />
              </div>
            </div>
            <div class="form-field-group">
              <label class="field-label">Sala:</label>
              <input class="field-input field-small" name="np1_sala" type="text" placeholder="Ex: 427" />
            </div>
            <div class="form-field-group">
              <label class="field-label">Aplicador(a):</label>
              <select class="field-select" name="np1_aplicador">
                <option value="">Selecione</option>
                {% if professores %}
                  {% for prof in professores %}
                    {% set nome_completo = prof.get('nome_completo') or (prof.get('nome_professor', '') + ' ' + prof.get('sobrenome_professor', '')).strip() %}
                    {% if nome_completo %}
                      <option value="{{ nome_completo }}">{{ nome_completo }}</option>
                    {% endif %}
                  {% endfor %}
                {% endif %}
              </select>
            </div>
            <div class="form-field-group">
              <label class="field-label">Conteúdo da Prova</label>
              <div class="textarea-wrapper">
                <textarea class="field-textarea" name="np1_conteudo" rows="7" maxlength="250" placeholder="Insira os tópicos ou material de estudo para essa prova."></textarea>
                <span class="char-counter">0 / 250 caracteres</span>
              </div>
            </div>
          </div>

          <div class="exam-section">
            <h3 class="exam-title">NP2</h3>
            <div class="form-field-group">
              <label class="field-label">Data:</label>
              <input class="field-input field-small" name="np2_data" type="date" />
            </div>
            <div class="form-row-group">
              <div class="form-field-group">
                <label class="field-label">Horário Inicío:</label>
                <input class="field-input" name="np2_inicio" type="time" />
              </div>
              <div class="form-field-group">
                <label class="field-label">Horário Fim:</label>
                <input class="field-input" name="np2_fim" type="time" />
              </div>
            </div>
            <div class="form-field-group">
              <label class="field-label">Sala:</label>
              <input class="field-input field-small" name="np2_sala" type="text" placeholder="Ex: 427" />
            </div>
            <div class="form-field-group">
              <label class="field-label">Aplicador(a):</label>
              <select class="field-select" name="np2_aplicador">
                <option value="">Selecione</option>
                {% if professores %}
                  {% for prof in professores %}
                    {% set nome_completo = prof.get('nome_completo') or (prof.get('nome_professor', '') + ' ' + prof.get('sobrenome_professor', '')).strip() %}
                    {% if nome_completo %}
                      <option value="{{ nome_completo }}">{{ nome_completo }}</option>
                    {% endif %}
                  {% endfor %}
                {% endif %}
              </select>
            </div>
            <div class="form-field-group">
              <label class="field-label">Conteúdo da Prova</label>
              <div class="textarea-wrapper">
                <textarea class="field-textarea" name="np2_conteudo" rows="7" maxlength="250" placeholder="Insira os tópicos ou material de estudo para essa prova."></textarea>
                <span class="char-counter">0 / 250 caracteres</span>
              </div>
            </div>
          </div>

          <div class="exam-section">
            <h3 class="exam-title">Exame</h3>
            <div class="form-field-group">
              <label class="field-label">Data:</label>
              <input class="field-input field-small" name="exame_data" type="date" />
            </div>
            <div class="form-row-group">
              <div class="form-field-group">
                <label class="field-label">Horário Inicío:</label>
                <input class="field-input" name="exame_inicio" type="time" />
              </div>
              <div class="form-field-group">
                <label class="field-label">Horário Fim:</label>
                <input class="field-input" name="exame_fim" type="time" />
              </div>
            </div>
            <div class="form-field-group">
              <label class="field-label">Sala:</label>
              <input class="field-input field-small" name="exame_sala" type="text" placeholder="Ex: 427" />
            </div>
            <div class="form-field-group">
              <label class="field-label">Aplicador(a):</label>
              <select class="field-select" name="exame_aplicador">
                <option value="">Selecione</option>
                {% if professores %}
                  {% for prof in professores %}
                    {% set nome_completo = prof.get('nome_completo') or (prof.get('nome_professor', '') + ' ' + prof.get('sobrenome_professor', '')).strip() %}
                    {% if nome_completo %}
                      <option value="{{ nome_completo }}">{{ nome_completo }}</option>
                    {% endif %}
                  {% endfor %}
                {% endif %}
              </select>
            </div>
            <div class="form-field-group">
              <label class="field-label">Conteúdo da Prova</label>
              <div class="textarea-wrapper">
                <textarea class="field-textarea" name="exame_conteudo" rows="7" maxlength="250" placeholder="Insira os tópicos ou material de estudo para essa prova."></textarea>
                <span class="char-counter">0 / 250 caracteres</span>
              </div>
            </div>
          </div>

          <div class="exam-section">
            <h3 class="exam-title">Sub</h3>
            <div class="form-field-group">
              <label class="field-label">Data:</label>
              <input class="field-input field-small" name="sub_data" type="date" />
            </div>
            <div class="form-row-group">
              <div class="form-field-group">
                <label class="field-label">Horário Inicío:</label>
                <input class="field-input" name="sub_inicio" type="time" />
              </div>
              <div class="form-field-group">
                <label class="field-label">Horário Fim:</label>
                <input class="field-input" name="sub_fim" type="time" />
              </div>
            </div>
            <div class="form-field-group">
              <label class="field-label">Sala:</label>
              <input class="field-input field-small" name="sub_sala" type="text" placeholder="Ex: 427" />
            </div>
            <div class="form-field-group">
              <label class="field-label">Aplicador(a):</label>
              <select class="field-select" name="sub_aplicador">
                <option value="">Selecione</option>
                {% if professores %}
                  {% for prof in professores %}
                    {% set nome_completo = prof.get('nome_completo') or (prof.get('nome_professor', '') + ' ' + prof.get('sobrenome_professor', '')).strip() %}
                    {% if nome_completo %}
                      <option value="{{ nome_completo }}">{{ nome_completo }}</option>
                    {% endif %}
                  {% endfor %}
                {% endif %}
              </select>
            </div>
            <div class="form-field-group">
              <label class="field-label">Conteúdo da Prova</label>
              <div class="textarea-wrapper">
                <textarea class="field-textarea" name="sub_conteudo" rows="7" maxlength="250" placeholder="Insira os tópicos ou material de estudo para essa prova."></textarea>
                <span class="char-counter">0 / 250 caracteres</span>
              </div>
            </div>
          </div>

          <div class="form-actions">
            <a class="btn-action btn-back" href="{{ url_for('calendario_add', step=3) }}">
              <svg width="19" height="17" viewBox="0 0 19 17" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M18 8.5L1 8.5M1 8.5L9.5 16M1 8.5L9.5 1" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              Voltar
            </a>
            <a class="btn-action btn-cancel" href="{{ url_for('calendario_list') }}">
              <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M13 1L1 13M1 1L13 13" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              Cancelar
            </a>
            <button class="btn-action btn-save" type="submit">
              <svg width="18" height="13" viewBox="0 0 18 13" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M17 1L6 12L1 7" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              Salvar
            </button>
          </div>
        </form>
        {% endif %}
      </div>
    </div>
  </main>

  <script>
    // Exibir nome do arquivo selecionado na etapa 2
    const ementaFileInput = document.getElementById('ementa-file');
    if (ementaFileInput) {
      ementaFileInput.addEventListener('change', function(e) {
        const fileName = e.target.files[0]?.name || '';
        const display = document.getElementById('ementa-file-name');
        if (display) {
          if (fileName) {
            display.textContent = `Arquivo selecionado: ${fileName}`;
            display.style.display = 'block';
          } else {
            display.style.display = 'none';
          }
        }
      });
    }

    // Contador de caracteres para textarea
    const textarea = document.querySelector('textarea[name="ementa_resumo"]');
    const charCounter = document.querySelector('.char-counter');
    if (textarea && charCounter) {
      textarea.addEventListener('input', function(e) {
        const length = e.target.value.length;
        charCounter.textContent = `${length} / 1000 caracteres`;
      });
      // Atualizar contador ao carregar página se houver valor
      if (textarea.value) {
        charCounter.textContent = `${textarea.value.length} / 1000 caracteres`;
      }
    }
  </script>

</body>
</html>
