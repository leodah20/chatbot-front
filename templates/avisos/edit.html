<!doctype html>
<html lang="pt-br">
<head>
    <!-- Configuração básica da página -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Editar Aviso - Painel Administrativo</title>

    <!-- Carregamento otimizado de fontes Google -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <!-- CSS específico da seção de avisos -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/docentes_styles.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/avisos_styles.css') }}">
</head>
<body>
    <!-- Cabeçalho principal - Padrão do painel -->
    <header>
        <div class="header-main">
            <div class="header-content">
                <!-- Logo e título da UNIP -->
                <div class="brand-section">
                    <img class="logo" src="https://api.builder.io/api/v1/image/assets/TEMP/c31fcbcb8d593740846e1ea27ca675ca1434c256?width=558" alt="UNIP Logo">
                    <h1 class="site-title">Painel Administrativo</h1>
                </div>
                
                <!-- Informações do usuário logado -->
                <div class="user-section">
                    <div class="user-info">
                        <div class="user-name">{{ session.user.nome|title if session.user else 'Usuário' }}</div>
                        <div class="user-email">{{ session.user.email if session.user else '' }}</div>
                    </div>
                    <a href="{{ url_for('logout') }}" class="btn-logout">sair</a>
                </div>
            </div>
        </div>
        
        <!-- Navegação - Submenu -->
        <div class="header-sub">
            <div class="menu-toggle">
                <svg class="menu-icon" viewBox="0 0 26 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M24.9709 7.14124H1.97898M24.9709 1.47656H1.97898M24.9709 12.8059H1.97898M24.9709 18.4706H1.97898" stroke="white" stroke-width="1.9993" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <span class="menu-text">Menu</span>
                <!-- Link para voltar ao aviso -->
                <a href="{{ url_for('avisos_view', aviso_id=aviso.id_aviso) }}" style="color: white; text-decoration: none; margin-left: 24px; display: flex; align-items: center; gap: 8px;">
                    <svg width="16" height="16" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M15.8333 10H4.16667M10 4.16667L4.16667 10L10 15.8333" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>Voltar ao Aviso</span>
                </a>
            </div>
        </div>
    </header>

    <!-- Conteúdo principal -->
    <main class="main-container">
        <div class="content-card">
            <!-- Título da página -->
            <div class="menu-infos-curso">
                <h2 class="text-wrapper-6">Avisos</h2>
            </div>

            <!-- Subtítulo "Editar" -->
            <div class="adicionar-materia">
                <svg class="img" width="54" height="54" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M35 15H5C3.61929 15 2.5 16.1193 2.5 17.5V32.5C2.5 33.8807 3.61929 35 5 35H35C36.3807 35 37.5 33.8807 37.5 32.5V17.5C37.5 16.1193 36.3807 15 35 15Z" fill="#1583FF"/>
                    <path d="M35 5H5C3.61929 5 2.5 6.11929 2.5 7.5V12.5C2.5 13.8807 3.61929 15 5 15H35C36.3807 15 37.5 13.8807 37.5 12.5V7.5C37.5 6.11929 36.3807 5 35 5Z" fill="#1583FF"/>
                    <path d="M8.75 8.75H31.25V11.25H8.75V8.75Z" fill="white"/>
                    <path d="M8.75 20H31.25V22.5H8.75V20Z" fill="white"/>
                    <path d="M8.75 25H31.25V27.5H8.75V25Z" fill="white"/>
                    <path d="M8.75 30H31.25V32.5H8.75V30Z" fill="white"/>
                    <path d="M11.25 2.5L17.5 8.75L6.25 20H2.5V16.25L11.25 2.5Z" fill="#1583FF" opacity="0.8"/>
                </svg>
                <h3 class="text-wrapper-7">Editar</h3>
            </div>

            <hr class="barra" />

            <!-- Sistema de mensagens flash -->
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    <div class="flash-messages">
                        {% for category, message in messages %}
                            <div class="alert alert-{{ 'danger' if category == 'error' else 'success' if category == 'success' else 'info' }}">
                                {{ message }}
                            </div>
                        {% endfor %}
                    </div>
                {% endif %}
            {% endwith %}

            <!-- Formulário de edição -->
            <form class="caixa-infos" method="POST" action="{{ url_for('avisos_edit', aviso_id=aviso.id_aviso) }}">
                <div class="frame">
                    <!-- Título do aviso -->
                    <div class="div-2">
                        <label class="text-wrapper-8" for="titulo-aviso">Título do Aviso:</label>
                        <input
                            class="nome-materia"
                            type="text"
                            id="titulo-aviso"
                            name="titulo"
                            placeholder="Cancelamento de Aula - Sistemas Distribuídos"
                            value="{{ aviso.titulo if aviso.titulo else '' }}"
                            required
                            maxlength="200"
                        />
                        <small class="char-counter" id="titulo-counter">{{ (aviso.titulo|length if aviso.titulo else 0) }}/200</small>
                    </div>

                    <!-- Descrição/Conteúdo do aviso -->
                    <div class="caixa-texto">
                        <label class="text-wrapper-9" for="descricao-aviso">Descrição</label>
                        <textarea
                            class="resumo-ementa"
                            id="descricao-aviso"
                            name="conteudo"
                            placeholder="Descrição do aviso."
                            required
                            maxlength="2000"
                        >{{ aviso.conteudo if aviso.conteudo else '' }}</textarea>
                        <small class="char-counter" id="conteudo-counter">{{ (aviso.conteudo|length if aviso.conteudo else 0) }}/2000</small>
                    </div>

                    <!-- Data de validade/publicação -->
                    <div class="div-2">
                        <label class="text-wrapper-9" for="data-validade">Data do Aviso</label>
                        <div class="selecione">
                            <input
                                type="date"
                                id="data-validade"
                                name="data"
                                class="data-input"
                                value="{% if aviso.data %}{{ (aviso.data[:10] if aviso.data is string else aviso.data.strftime('%Y-%m-%d') if aviso.data else '') }}{% endif %}"
                                required
                            />
                            <svg class="vector-2" width="21" height="11" viewBox="0 0 21 11" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M1 1L10.5 10L20 1" stroke="#494949" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                    </div>

                    <!-- Professor responsável (opcional) -->
                    <div class="div-2">
                        <label class="text-wrapper-9" for="id_professor">Professor Responsável (Opcional)</label>
                        <div class="selecione">
                            <select class="data-2" id="id_professor" name="id_professor">
                                <option value="">Selecione um professor</option>
                                {% if professores %}
                                    {% for professor in professores %}
                                        <option value="{{ professor.id }}" {% if aviso.id_professor == professor.id or (aviso.id_professor|string) == (professor.id|string) %}selected{% endif %}>
                                            {{ professor.nome_professor }} {{ professor.sobrenome_professor }}
                                        </option>
                                    {% endfor %}
                                {% endif %}
                            </select>
                            <svg class="vector-2" width="21" height="11" viewBox="0 0 21 11" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M1 1L10.5 10L20 1" stroke="#494949" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                    </div>

                    <!-- Coordenador responsável (opcional) -->
                    <div class="div-2">
                        <label class="text-wrapper-9" for="id_coordenador">Coordenador Responsável (Opcional)</label>
                        <div class="selecione">
                            <select class="data-2" id="id_coordenador" name="id_coordenador">
                                <option value="">Selecione um coordenador</option>
                                {% if coordenadores %}
                                    {% for coordenador in coordenadores %}
                                        <option value="{{ coordenador.id }}" {% if aviso.id_coordenador == coordenador.id or (aviso.id_coordenador|string) == (coordenador.id|string) %}selected{% endif %}>
                                            {{ coordenador.nome_coordenador }} {{ coordenador.sobrenome_coordenador }}
                                        </option>
                                    {% endfor %}
                                {% endif %}
                            </select>
                            <svg class="vector-2" width="21" height="11" viewBox="0 0 21 11" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M1 1L10.5 10L20 1" stroke="#494949" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                    </div>
                </div>

                <!-- Botões de ação -->
                <div class="botoes">
                    <a href="{{ url_for('avisos_view', aviso_id=aviso.id_aviso) }}" class="botao-cancelar">
                        <svg class="vector-3" width="14" height="14" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M15.8333 10H4.16667M10 4.16667L4.16667 10L10 15.8333" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span class="text-wrapper-10">Cancelar</span>
                    </a>
                    <button class="botao-salvar" type="submit">
                        <svg class="vector-4" width="18" height="13" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M16.6667 5L7.50004 14.1667L3.33337 10" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span class="text-wrapper-11">Salvar</span>
                    </button>
                </div>
            </form>
        </div>
    </main>

    <!-- JavaScript para funcionalidades do formulário -->
    <script>
        // Contador de caracteres
        const tituloInput = document.getElementById('titulo-aviso');
        const conteudoTextarea = document.getElementById('descricao-aviso');
        const tituloCounter = document.getElementById('titulo-counter');
        const conteudoCounter = document.getElementById('conteudo-counter');

        // Atualizar contadores
        function updateCounters() {
            if (tituloInput && tituloCounter) {
                const tituloLen = tituloInput.value.length;
                tituloCounter.textContent = `${tituloLen}/200`;
                if (tituloLen > 180) {
                    tituloCounter.style.color = '#dc3545';
                } else {
                    tituloCounter.style.color = '#49494994';
                }
            }

            if (conteudoTextarea && conteudoCounter) {
                const conteudoLen = conteudoTextarea.value.length;
                conteudoCounter.textContent = `${conteudoLen}/2000`;
                if (conteudoLen > 1800) {
                    conteudoCounter.style.color = '#dc3545';
                } else {
                    conteudoCounter.style.color = '#49494994';
                }
            }
        }

        if (tituloInput) {
            tituloInput.addEventListener('input', updateCounters);
        }

        if (conteudoTextarea) {
            conteudoTextarea.addEventListener('input', updateCounters);
        }

        // Inicializar contadores
        updateCounters();

        // Validação do formulário
        const form = document.querySelector('.caixa-infos');
        if (form) {
            form.addEventListener('submit', function(e) {
                const titulo = tituloInput?.value.trim();
                const conteudo = conteudoTextarea?.value.trim();
                const dataInput = document.getElementById('data-validade');
                const data = dataInput?.value;

                if (!titulo || !conteudo || !data) {
                    e.preventDefault();
                    alert('Por favor, preencha todos os campos obrigatórios.');
                    return;
                }

                if (titulo.length > 200) {
                    e.preventDefault();
                    alert('O título deve ter no máximo 200 caracteres.');
                    tituloInput.focus();
                    return;
                }

                if (conteudo.length > 2000) {
                    e.preventDefault();
                    alert('O conteúdo deve ter no máximo 2000 caracteres.');
                    conteudoTextarea.focus();
                    return;
                }

                // Garantir que apenas um autor seja selecionado
                const professorSelect = document.getElementById('id_professor');
                const coordenadorSelect = document.getElementById('id_coordenador');
                
                if (professorSelect && coordenadorSelect) {
                    if (professorSelect.value && coordenadorSelect.value) {
                        e.preventDefault();
                        alert('Selecione apenas um autor: professor ou coordenador, não ambos.');
                        return;
                    }
                }
            });
        }

        // Garantir que apenas um autor seja selecionado ao mudar
        const professorSelect = document.getElementById('id_professor');
        const coordenadorSelect = document.getElementById('id_coordenador');
        
        if (professorSelect) {
            professorSelect.addEventListener('change', function() {
                if (this.value && coordenadorSelect) {
                    coordenadorSelect.value = '';
                }
            });
        }
        
        if (coordenadorSelect) {
            coordenadorSelect.addEventListener('change', function() {
                if (this.value && professorSelect) {
                    professorSelect.value = '';
                }
            });
        }
    </script>
</body>
</html>
